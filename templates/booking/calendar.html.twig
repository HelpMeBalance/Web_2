{# templates/calendar/index.html.twig #}
{% extends 'base.html.twig' %}

{% block body %}
    <div id='external-events'>
        <p>
            <strong>Draggable Events</strong>
        </p>

        {% for booking in bookings %}
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
        <div class='fc-event' data-booking-id='{{ booking.id }}'>{{ booking.title }}</div>
        </div>
        {% endfor %}

        <!-- Add other events here -->

        <p>
            <input type='checkbox' id='drop-remove' />
            <label for='drop-remove'>remove after drop</label>
        </p>
    </div>

    <div id='calendar-container'>
        <div id='calendar'></div>
    </div>
{% endblock %}

{% block javascripts %}
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var Calendar = FullCalendar.Calendar;
            var Draggable = FullCalendar.Draggable;

            var containerEl = document.getElementById('external-events');
            var calendarEl = document.getElementById('calendar');
            var checkbox = document.getElementById('drop-remove');

            // Initialize the external events
            new Draggable(containerEl, {
                itemSelector: '.fc-event',
                eventData: function(eventEl) {
                    return {
                        title: eventEl.innerText
                    };
                }
            });

            // Initialize the calendar
            var calendar = new Calendar(calendarEl, {
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                editable: true,
                droppable: true,
                drop: function(info) {
                    // Is the "remove after drop" checkbox checked?
                    if (checkbox.checked) {
                        // If so, remove the element from the "Draggable Events" list
                        info.draggedEl.parentNode.removeChild(info.draggedEl);
                    }
                }
            });

            calendar.render();
        });
    </script>
{% endblock %}
