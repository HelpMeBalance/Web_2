{% extends 'frontClient/base.html.twig' %}
{% set stars = 0 %}
{% block body %}
<section class="testimonial_section section_space_lg">
  <div class="container">
    <div class="section_heading text-center">
      <h2 class="section_heading_text">Appointment Managment</h2>
      <a href="{{ path('app_rendez_vous_new') }}">Create new appointment</a>
      <p class="section_heading_description mb-0">
        {{app.user.firstname}} {{app.user.lastname}}
      </p>
    </div>
    <div class="testimonial_carousel">
      <div class="carousel_2col row" data-slick='{"arrows":false}'>
        {% for rv in rendezvous %}
        {% if app.user == rv.patient %}
        <div class="carousel_item col-">
          <div class="testimonial_item">
            {% if rv.statut %}
            {% for c in consultation %}
            {% if c.rendezvous == rv %}
            {% set stars = c.avisPatient %}
            {% endif %}
            {% endfor %}
            <ul class="rating_star unordered_list">
              {% for _ in range(0,stars ) %}
              <li><i class="fa-solid fa-star"></i></li>
              {% endfor %}
            </ul>
            {% else %}
            {#print form for avisPatient here#}
            {% endif %}
            <div class="author_box">
              <div class="author_box_image">
                <img src="{{asset('assets/images/gallery/4.png')}}" alt="Reviewer Image" />
              </div>
              <div class="author_box_content ">
                <h3 class="author_box_name">{{rv.dateR|date('Y-m-d H:i:s') }}</h3>
                <span class="author_box_designation">{{rv.statut ? 'Confirmed' : 'Not Confirmed'}}</span>
              </div>
            </div>
            <p class="mb-0 d-flex justify-content-center">
              {{rv.nomService}}
            </p>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
    <div id='calendar'></div>
    <!-- Modal Structure -->
<div class="modal fade" id="eventDetailsModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="eventModalLabel">Appointment Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p id="serviceDetail"></p>
        <p id="psyNameDetail"></p>
        <p id="dateDetail"></p>
        <p id="timeDetail"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

  </div>
</section>
{% block script %}
    <script>document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: [
        {% for rv in rendezvous %}
          {% if app.user == rv.patient %}
            {
              title: '{{ rv.nomService }}',
              start: '{{ rv.dateR|date("Y-m-d H:i") }}',
              extendedProps: {
                time: '{{ rv.dateR|date("H:i") }}',
                date: '{{ rv.dateR|date("Y-m-d") }}'
              }
            },
          {% endif %}
        {% endfor %}
      ],
      eventClick: function(info) {
        // Fill in the modal with the event details
        document.getElementById('serviceDetail').textContent = 'Service: ' + info.event.title;
        document.getElementById('psyNameDetail').textContent = 'Psy Name: ' + info.event.extendedProps.psyName;
        document.getElementById('dateDetail').textContent = 'Date: ' + info.event.extendedProps.date;
        document.getElementById('timeDetail').textContent = 'Time: ' + info.event.extendedProps.time;

        // Show the modal
        var eventModal = new bootstrap.Modal(document.getElementById('eventDetailsModal'), {
          keyboard: false
        });
        eventModal.show();
      }
    });
    calendar.render();
  });</script>
{% endblock script %}

{% endblock %}